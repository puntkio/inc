function escape(e){return e?("string"!=typeof e&&(e=e.toString()),e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#x27;").replaceAll("/","&#x2F;")):e}function stripScripts(e){"string"!=typeof e&&(e=e.toString());var t=document.createElement("div");t.innerHTML=e;for(var r=t.getElementsByTagName("script"),n=r.length;n--;)r[n].parentNode.removeChild(r[n]);return t.innerHTML}function formatBet(e){var t=e||0;return t.toLocaleString()}function unformatBet(e){var t=e||0;return t.replaceAll(",","").replaceAll(" ","").replaceAll(".","")}var App=function(e){var t=this;return t.jquery=t.$=e,t.ui={},t.moderationUser={},_.forEach(App.prototype.__onload,function(e){e(t,t.jquery)}),t};App.prototype.__onload=[],App.prototype.onLoad=function(e){App.prototype.__onload.push(e)};var ApiError=function(e,t){this.code=t,this.text=null,_.isObject(e)?(this.code=e.code||e.statusCode||e.status||null,this.text=e.text||e.message||e.responseText||e.toString()):_.isString(e)&&(this.text=e),this.toString=function(){return this.text}},Api=function(e,t){var r=this;r.search_user=function(e,t){return n("POST","search",e,t)},r.get_user_bets=function(e,t){return n("POST","user-bets",{userId:e},t)},r.get_user_transactions=function(e,t){return n("GET","tables/user/"+e+"/transactions",{},t)},r.get_user_transfers=function(e,t){return n("GET","tables/user/"+e+"/transfers",{},t)};var n=function(e,r,n,o){n||(n={}),n._csrf||(n._csrf=csrfToken||null),o||(o=function(){});var a=t.ajax({type:e,url:"/"+r,data:n});return a.fail(function(e){o(new ApiError(e))}),a.done(function(e){return e?e.err?o(new ApiError(e.err)):e.error?o(new ApiError(e.error)):e.is_error?o(new ApiError(e.error||e.err||"error")):o(null,e):o(new ApiError("empty_response"))}),a};return r};App.prototype.onLoad(function(e,t){e.api=new Api(e,t)}),App.prototype.onLoad(function(e,t){var r={};e.onShowTabContent=function(e,t){r[e]||(r[e]=[]),r[e].push(t)};var n={};e.showContent=function(e){var o=[".skin-content",".bot-content",".main",".stat-content",".history-content"];o.forEach(function(o){o===e?(t(o).show(),n[e]||(n[e]=0),r[e]&&r[e].length&&_.forEach(r[e],function(t){n[e]+=1,t(e,n[e])})):t(o).hide()})}}),String.prototype.replaceAll=function(e,t){return this.split(e).join(t)},App.prototype.onLoad(function(e,t){e.templateObject=function(r,n){var o;r.context&&r[0]?(o=r,r=o.html()):o=t(r);var a={text:r};return a.$html=o,a.mapped={},o.find("[data-id]").each(function(e){var r=t(this).data("id");a.mapped[r]={elem:t(this),value:""}}),console.log("INIT",_.size(a.mapped)),n||(a.partials={},o.find("[data-partial]").each(function(){var e=t(this).data("partial");t(this).removeAttr("data-partial");var r=t(this)[0].outerHTML;t(this).remove(),a.partials[e]=r})),console.log("PRE",_.size(a.mapped)),a.render=function(e,t){e&&a.map(e,o),t===!0?t={html:!0}:t||(t={html:!1}),_.forEach(a.mapped,function(r,n){var i=r.elem,s=r.value;i[0]&&(_.isFunction(s)&&(s=s(i,n,e)),t.partial&&(s=a.renderPartial(t.partial,s)),o?i.html(s):i.text(s))})},a.find=function(e){return a.$html.find(e)},a.id=function(e){if(a.mapped[e])return a.mapped[e].elem;var t=a.find("#"+e);return t.length>0?t:a.find('[data-id="'+e+'"]')},a.clear=function(){return a.clearMapped(),n&&a.clearBody(),a},a.map=function(e,t){return console.log("MAP",_.size(a.mapped)),"undefined"==typeof t&&(t=!0),!(!e||!_.isObject(e))&&(_.forEach(e,function(e,t){a.mapped[t]&&(a.mapped[t].value=e)}),console.log(a.mapped),a)},a.clearMapped=function(){return _.forEach(a.mapped,function(e,t){e.value=null}),a.render(),a},a.remap=function(e,t){return a.clearMapped().map(e,t)},a.refresh=a.remap,a.renderPartial=function(t,r){if(!a.partials[t])return value;var t=e.templateObject(a.partials[t],!0);return t.map(r),t.$html},a.appendPartial=function(e,t,r){var n=a.id(e);n.append(a.renderPartial(t,r))},a.clearBody=function(){var e=a.id("body");e.html("")},a.bodyPartial=function(e,t){var r=a.id("body");r.append(a.renderPartial(e,t))},a}}),App.prototype.onLoad(function(e,t){t(".main-tab").on("click",function(){e.showContent(".main")}),t(".skin-tab").on("click",function(){e.showContent(".skin-content")}),t(".stat-tab").on("click",function(){e.showContent(".stat-content")}),t(".bot-tab").on("click",function(){e.showContent(".bot-content")}),t(".history-tab").on("click",function(){e.showContent(".history-content")})}),App.prototype.onLoad(function(e,t){function r(t){(t.openId||t.referralCode)&&e.api.search_user(t,function(t,r){return t?toastr.error("Failed to fetch user"):(e.moderationUser=r.user||{},toastr.success("User Found"),void e.ui.user.showSearchResults(r))})}function n(t){return!(!e.moderationUser||!e.moderationUser.openId)&&(i.addClass("uk-icon-spin"),void e.api.get_user_transactions(e.moderationUser.openId,function(e,t){t.transactions&&(i.removeClass("uk-icon-spin"),generateTransactions(t.transactions))}))}function o(t){return!(!e.moderationUser||!e.moderationUser.openId)&&(s.addClass("uk-icon-spin"),void e.api.get_user_transfers(e.moderationUser.openId,function(e,t){t.transfers&&(s.removeClass("uk-icon-spin"),generateUserTransfers(t.transfers))}))}function a(r,a){if(!e.moderationUser||!e.moderationUser.openId)return!1;var i=!1;if(r&&!a&&(a=r),a){var s=t(this).find(".uk-accordion-content.uk-active");i||(i=s.data("refresh")),"refresh_user_transactions"===i?n():"refresh_user_transfers"===i&&o()}}var i=t(".spinner-user-transactions"),s=t(".spinner-user-transfers"),u=UIkit.accordion(t("#user-accordion"));t("#user-transfers").html(""),t("#user-search").click(function(){var e={openId:t("#id64-field").val().trim(),referralCode:t("#ref-field").val().trim()};r(e)}),t("#bet-refresh").on("click",function(){return console.log(e.moderationUser),!(!e.moderationUser||!e.moderationUser.openId)&&void(e.moderationUser.openId&&e.api.get_user_bets(e.moderationUser.openId,function(t,r){return t?(500!==t.code?toastr.error(t.text):toastr.error("Failed to find Bets"),!1):(toastr.success("User Bets Found"),void e.ui.user.showBetResults(r))}))}),i.on("click",function(e){return e.preventDefault(),n(),!1}),s.on("click",function(e){return e.preventDefault(),o(),!1}),u.on("toggle.uk.accordion",a),e.onShowTabContent(".main",function(e){a()})}),App.prototype.onLoad(function(e,t){var r=function(){var r=this,n=e.templateObject(t("#user_search_results")),o=e.templateObject(t("#user_bets_results")),a=e.templateObject(t("#user_bets_table")),i=t("#user-edit");r.showSearchResults=function(e){var t=e.user||{},r=e.sends||[],a=e.transactions||[],l=e.credits||[],p=s(t),d=u(t,r),f=c(a,l);n.clear(),o.clear(),n.map(p).render(),o.map(d).map(f).render(),i.show()},r.clearSearchResults=function(){n.clearMapped(),o.clearMapped(),a.clear(),i.hide()},r.showBetResults=function(e){var t=l(e);o.map(t).render(),a.clear(),_.forEach(t.bet_entries,function(e){a.bodyPartial("row",{value:"1",color:"2",date:"3"})})},r.clearBetsResults=function(){o.clearMapped(),a.clear()},r.user_profile_link=function(e){var r="object"==typeof e&&e.openId?e.openId:e;return t('<a target="_blank"></a>').attr("href","https://steamcommunity.com/profiles/"+r).text(r)},r.user_tradeurl_link=function(e){var r="object"==typeof e&&e.tradeUrl?e.tradeUrl:e;return t('<a target="_blank"></a>').attr("href",r).html(escape(r))},r.level=function(e){return Math.min(500,Math.floor(e.playedValue/5e4))},r.muteText=function(e){var t="No";return 1==e.muted?t="Permanent Mute":2==e.muted&&(t="Mute until ",e.muteExpire?t+=e.muteExpire:t="N/A (Invalid date?)"),t};var s=function(e){var n=null,o={openId:r.user_profile_link(e),balance:formatBet(e.value),"deposit-value":formatBet(e.depositValue),played:formatBet(e.playedValue),level:r.level(e),collected:formatBet(e.collectedReward),"max-bet":formatBet(e.maxBet),"ref-code":escape(e.referralCode),tradeUrl:r.user_tradeurl_link(e.tradeUrl),verified:e.verified?"True":"False",withdrawLock:e.withdrawLock?"True":"False",tradeLock:e.tradeLock?"True":"False",muted:r.muteText(e),"export-bets":function(t){t.prop("href","/export/bets/"+e.openId)},"export-sends":function(t){t.prop("href","/export/sends/"+e.openId)}};return n=t.extend({},e,o)},u=function(e,t){var r=0,n=0,o=0,a={};return _.forEach(t,function(t){var a=t.destination===e.openId?"recv":"sent";"recv"===a?(n+=t.value,o+=t.value):"sent"===a&&(r+=t.value,o-=t.value)}),a.sends_sent=formatBet(r),a.sends_received=formatBet(n),a.sends_total=formatBet(o),a},c=function(e,t){for(var r={},n=0,o=0,a=0,i=0,s=0,u=0,c=0,l=0,p=0;p<e.length;p++){var d=e[p];"Accepted"===d.state&&("Deposit"===d.action?n+=d.value:"Withdraw"===d.action&&(o+=d.value))}return _.forEach(t,function(e){e.isRefund||void 0===e.isRefund?(u+=e.skinxvalue||0,c+=e.value||0,l+=e.depositValue||0):(a+=e.skinxvalue||0,i+=e.value||0,s+=e.depositValue||0)}),r.deposited=formatBet(n),r.withdrawn=formatBet(o),r.credited=formatBet(i),r.deposit_credited=formatBet(s),r.refunded=formatBet(c),r.deposit_refunded=formatBet(l),r.transaction_profit=formatBet(o-(n+s)),r},l=function(e){var t={};t.bets=formatBet(e.bets),t.winnings=formatBet(e.winnings),t.bet_profit=formatBet(e.winnings-e.bets),t.bet_entries=[];for(var r=e.last,n=0;n<r.length;n++){var o=r[n],a=o.value;"in"===o.type&&(a*=-1);var i="Gold";0===o.choice?i="Gray":1===o.choice?i="Red":2===o.choice&&(i="Blue");var s={value:a,color:i,date:moment(o.date).format("MMMM Do YYYY, h:mm:ss a")};t.bet_entries.push(s)}return t};return r};e.ui.user=new r}),jQuery(function(e){var t=new App(e);t.showContent(".main")});